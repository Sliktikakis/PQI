<script>
var val_stock = ""
var val = ""
var val_affiche = ""

$(document).ready(function(){
    $("#submit").mouseenter(function(){
        val = $("#rencontre_date").val();
        val_affiche = val.slice(8,10) + '/' + val.slice(5,7) + '/' + val.slice(2,4);
        if (val_stock != val) {
            val_stock = val;
            if (gon.renc.indexOf(val) > -1) {
                alert("Etes-vous sûr(e) ? Cette personne a déjà été rencontrée le " + val_affiche + ".");
            };
        };
    });
});
</script>

<% provide(:title, "#{@rencontre.type_renc} prévue") %>

<%= simple_form_for(@rencontre) do |f| %>

<h1>
  Modifier la rencontre prévue<br>
  <%= @rencontre.type_renc %> du <%= @rencontre.date.strftime("%d/%m/%y") %>
  <br><button type="button" class="btn btn-danger">
    <%= link_to "Supprimer la rencontre", @rencontre,
                                          method: :delete,
                                          data: { confirm: "Etes-vous sûr(e) ?" },
                                          id: 'no-styling' %>
  </button>
</h1>

<h3>Date</h3>

  <%= f.input :date, label: false, :as => :date_picker, input_html: {value: @rencontre.date.strftime("%F")}, class: 'form-control' %>

<div class="form-inline">
  <%= f.label :signale, "Nouveau signalement ?" %>
  <%= f.check_box :signale, class: 'form-control' %><br>

  <%= f.label :signalement, "Si oui, type de signalement ?" %>
  <%= f.select :signalement,	[	["Signalement 115", "Signalement 115"],
                      				  ["Signalement tiers", "Signalement tiers"]],
                      			prompt: "Quel type de signalement ?",
                      			class: 'form-control' %>
</div>

<h3>Accompagnement</h3>

<div class="form-inline">
  <%= f.label :accomp, "Accompagnement" %>
  <%= f.check_box :accomp, checked: false, class: 'form-control' %><br>

  <%= f.label :type_accomp, "Si oui, type d'accompagnement ?" %>
  <%= f.select :type_accomp, @accomps, prompt: "Quel type d'accompagnement ?", class: 'form-control' %>
</div>

<h3>Type</h3>

  <%= f.select :type_renc, @types, prompt: "Quel type de rencontre ?", class: 'form-control' %><br>

<div class="form-inline">
  <%= f.label :dnv, "Maraude déplacée mais personne non vue" %>
  <%= f.check_box :dnv, checked: false, class: 'form-control' %>
</div>

<div class="form-inline">
  <%= f.label :prev, "Toujours rencontre prévisionnelle" %>
  <%= f.check_box :prev, checked: false, class: 'form-control' %>
</div>

<h3>Détails</h3>

  <%= f.text_area :details, class: 'form-control', html: {style: 'text-align:center'} %>

<% if @usager.enfants.any? %>
  <br><%= f.select :nb_enf, @nb_enf, prompt: "Nb d'enfants vus", class: 'form-control' %><br>
<% end %>

<h3>Prestations</h3>

<div>
  <% for presta in @prestas do %>
    <% if @rencontre.prestas.split(" #").include?("#{presta.first}") %>
      <%= f.check_box :prestas, { :multiple => true, :checked => true }, "#{presta.first}" %>
      <%= presta.first %><br>
    <% else %>
      <%= f.check_box :prestas, { :multiple => true, :checked => false }, "#{presta.first}" %>
      <%= presta.first %><br>
    <% end %>
  <% end %>
</div>

  <%= f.submit "Valider les modifications", class: 'btn btn-primary', id: 'submit' %>

<% end %>